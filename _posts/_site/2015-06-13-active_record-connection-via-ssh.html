<p>Making a ssh connection of ActiveRecord is very easy and the following will show 
you how to achieve it</p>

<h3 id="gems-dependencies">gems dependencies</h3>

<ul>
  <li>active_record</li>
  <li>mysql2</li>
  <li>net-ssh-gateway</li>
</ul>

<h3 id="make-a-ssh-connection">make a ssh connection</h3>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'net/ssh/gateway'</span>
<span class="nb">require</span> <span class="s1">'active_record'</span>
<span class="nb">require</span> <span class="s1">'mysql2'</span>
<span class="n">tunnel</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">SSH</span><span class="o">::</span><span class="no">Gateway</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
  <span class="s1">'host'</span><span class="p">,</span> <span class="c1">#Host which could connect to desired database</span>
  <span class="s1">'user'</span><span class="p">,</span> <span class="c1"># Username of the host</span>
  <span class="ss">:password</span><span class="o">=&gt;</span><span class="s1">'your vps password'</span>
  <span class="p">)</span>
<span class="n">port</span> <span class="o">=</span> <span class="n">tunnel</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s1">'sem3'</span><span class="p">,</span><span class="s1">'3306'</span><span class="p">)</span>
<span class="c1"># database configuration</span>
<span class="vg">$CONFIG</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">adapter:  </span><span class="s2">"mysql2"</span><span class="p">,</span>
  <span class="ss">host:     </span><span class="s2">"127.0.0.1"</span><span class="p">,</span>
  <span class="ss">username: </span><span class="s2">"public_user"</span><span class="p">,</span>
  <span class="ss">password: </span><span class="s2">"public_user"</span><span class="p">,</span>
  <span class="ss">database: </span><span class="s2">"production"</span><span class="p">,</span>
  <span class="ss">port: </span><span class="n">port</span><span class="p">,</span>
  <span class="ss">pool: </span><span class="mi">5</span><span class="p">,</span>
  <span class="ss">timeout: </span><span class="mi">5000</span><span class="p">,</span>
  <span class="ss">reconnect: </span><span class="kp">true</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">BaseGeneralHotelPoi</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="nb">self</span><span class="p">.</span><span class="nf">establish_connection</span><span class="p">(</span><span class="vg">$CONFIG</span><span class="p">)</span>
<span class="k">end</span>

<span class="nb">p</span> <span class="no">BaseGeneralHotelPoi</span><span class="p">.</span><span class="nf">take</span>
<span class="n">tunnel</span><span class="p">.</span><span class="nf">shutdown!</span></code></pre></figure>

<h3 id="use-ssh-authentication">Use ssh authentication</h3>
<p>Just like ssh-login, we can also use ssh key as the identification</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">tunnel</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">SSH</span><span class="o">::</span><span class="no">Gateway</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'seo'</span><span class="p">,</span><span class="s1">'op'</span><span class="p">,</span> <span class="ss">:keys</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'/Users/timlen/.ssh/id_rsa'</span><span class="p">])</span></code></pre></figure>

<p>You get it !</p>
