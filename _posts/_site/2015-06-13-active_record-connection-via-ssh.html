<p>Making a ssh connection of ActiveRecord is very easy and the following will show 
you how to achieve it</p>

<h3 id="gems-dependencies">gems dependencies</h3>

<ul>
  <li>active_record</li>
  <li>mysql2</li>
  <li>net-ssh-gateway</li>
</ul>

<h3 id="make-a-ssh-connection">make a ssh connection</h3>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;net/ssh/gateway&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;active_record&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;mysql2&#39;</span>
<span class="n">tunnel</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">SSH</span><span class="o">::</span><span class="no">Gateway</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
  <span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="c1">#Host which could connect to desired database</span>
  <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="c1"># Username of the host</span>
  <span class="ss">:password</span><span class="o">=&gt;</span><span class="s1">&#39;your vps password&#39;</span>
  <span class="p">)</span>
<span class="n">port</span> <span class="o">=</span> <span class="n">tunnel</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;sem3&#39;</span><span class="p">,</span><span class="s1">&#39;3306&#39;</span><span class="p">)</span>
<span class="c1"># database configuration</span>
<span class="vg">$CONFIG</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">adapter</span><span class="p">:</span>  <span class="s2">&quot;mysql2&quot;</span><span class="p">,</span>
  <span class="ss">host</span><span class="p">:</span>     <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
  <span class="ss">username</span><span class="p">:</span> <span class="s2">&quot;public_user&quot;</span><span class="p">,</span>
  <span class="ss">password</span><span class="p">:</span> <span class="s2">&quot;public_user&quot;</span><span class="p">,</span>
  <span class="ss">database</span><span class="p">:</span> <span class="s2">&quot;production&quot;</span><span class="p">,</span>
  <span class="ss">port</span><span class="p">:</span> <span class="n">port</span><span class="p">,</span>
  <span class="ss">pool</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="ss">timeout</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
  <span class="ss">reconnect</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">BaseGeneralHotelPoi</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">establish_connection</span><span class="p">(</span><span class="vg">$CONFIG</span><span class="p">)</span>
<span class="k">end</span>

<span class="nb">p</span> <span class="no">BaseGeneralHotelPoi</span><span class="o">.</span><span class="n">take</span>
<span class="n">tunnel</span><span class="o">.</span><span class="n">shutdown!</span></code></pre></div>

<h3 id="use-ssh-authentication">Use ssh authentication</h3>
<p>Just like ssh-login, we can also use ssh key as the identification</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">tunnel</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">SSH</span><span class="o">::</span><span class="no">Gateway</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;seo&#39;</span><span class="p">,</span><span class="s1">&#39;op&#39;</span><span class="p">,</span> <span class="ss">:keys</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;/Users/timlen/.ssh/id_rsa&#39;</span><span class="o">]</span><span class="p">)</span></code></pre></div>

<p>You get it !</p>
